from scrapy.spider import BaseSpider
from scrapy.selector import HtmlXPathSelector
from scrapy.http import Request

from product.items import Product


class CanadaComputers(BaseSpider):
    name = "canadacomputers"
    allowed_domains = ["canadacomputers.com"]
    
    start_urls = [
        "http://www.canadacomputers.com/index.php?cPath=710_577&&page=%d" % i for i in range(1,2)
    ]
  
    
    def parse(self, response):
    
        hxs = HtmlXPathSelector(response)
        sites = hxs.select("//table[contains(@class,'productListing')]")
        items = []


        for site in sites:
            titles = site.select("//div[contains(@class,'item_description')]/a/text()[1]").extract()
            urls = site.select("//div[contains(@class,'item_description')]/a/@href").extract()

            

     
        for title, url in zip(titles, urls):
            item = Product()
            item["title"] = title
            item["url"] = url
            items.append(item)   
           
        return items
        
    def parse2(self, response):
        item = response.meta["item"]
        
   
