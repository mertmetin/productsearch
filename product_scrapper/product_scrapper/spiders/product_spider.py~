from scrapy.spider import BaseSpider
from scrapy.selector import HtmlXPathSelector

from product.items import Source

class ProductSpider(BaseSpider):
    name = "product"
    allowed_domains = ["dmoz.org"]
    start_urls = [
        "http://www.thesource.ca/estore/category.aspx?language=en-CA&catalog=Online&category=Acerlaptop",
        "http://www.thesource.ca/estore/category.aspx?language=en-CA&catalog=Online&category=Acerlaptop&sort=6&pagenum=2",
        "http://www.thesource.ca/estore/category.aspx?language=en-CA&catalog=Online&category=Asuslaptop",
        "http://www.thesource.ca/estore/category.aspx?language=en-CA&catalog=Online&category=Gatewaylaptop",
        "http://www.thesource.ca/estore/category.aspx?language=en-CA&catalog=Online&category=Hplaptop",
        "http://www.thesource.ca/estore/category.aspx?language=en-CA&catalog=Online&category=Toshibalaptop"
    ]
    
    def parse(self, response):
    
        hxs = HtmlXPathSelector(response)
        sites = hxs.select('//*[@id="ListViewProductList_ProductDataList"]')
        items = []


        for site in sites:

            titles = site.select("//a[contains(@id,'ProductName')]/text()").extract()
            urls = site.select("//a[contains(@id,'ProductName')]/@href").extract()
            prices = site.select("//span[@class='ProductPrice']/text()").extract()
            
        for title, url, price in zip(titles,urls,prices):
            item = Source()
            item['title'] = title
            item['url'] = url
            item['price'] = price
            items.append(item)
      
        
        
        
        return items
